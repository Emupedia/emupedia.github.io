{"version":3,"sources":["node_modules/browser-pack/_prelude.js","js-dos-ts/js-dos-build.ts","js-dos-ts/js-dos-cache-db.ts","js-dos-ts/js-dos-cache-noop.ts","js-dos-ts/js-dos-cache.ts","js-dos-ts/js-dos-ci.ts","js-dos-ts/js-dos-conf.ts","js-dos-ts/js-dos-dom.ts","js-dos-ts/js-dos-fs.ts","js-dos-ts/js-dos-host.ts","js-dos-ts/js-dos-module.ts","js-dos-ts/js-dos-options.ts","js-dos-ts/js-dos-ui.ts","js-dos-ts/js-dos-xhr.ts","js-dos-ts/js-dos.ts"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Build","version","jsVersion","wasmJsSize","wasmVersion","wasmSize","jsSize","CacheDb","onready","onerror","_this","this","storeName","db","indexedDB","window","mozIndexedDB","webkitIndexedDB","msIndexedDB","openRequest","open","event","onsuccess","result","onupgradeneeded","createObjectStore","prototype","put","key","data","onflush","transaction","oncomplete","objectStore","get","ondata","request","forEach","each","onend","openCursor","cursor","target","toString","value","continue","CacheNoop","js_dos_cache_db_1","__importDefault","js_dos_cache_noop_1","default","msg","undefined","log","DosCommandInterface","dos","shellInputQueue","shellInputClients","em","api","ping","args","_i","arguments","onping","width","canvas","height","fullscreen","requestFullscreen","shell","cmd","Promise","resolve","reject","push","cmd_1","next","requestShellInput","screenshot","send","exit","terminate","error","simulateKeyEvent","keyCode","pressed","name","document","createEvent","getter","keyCodeVal","Object","defineProperty","initKeyboardEvent","defaultView","initKeyEvent","dispatchEvent","simulateKeyPress","setTimeout","sendKeyPress","onframe","buffer","maxLength","shift","cmdLength","lengthBytesUTF8","stringToUTF8","_a","tick","js_dos_options_1","config","conf","jsdosconf","keys","DosBoxConfigDefaults","placeholder","replace","applyCss","id","css","getElementById","style","createElement","innerHTML","head","appendChild","createDiv","className","el","js_dos_xhr_1","DosFS","syncingPromise","lastSyncTime","fs","FS","registerTickListener","Date","now","syncFs","registerPauseListener","registerTerminateListener","chdir","path","extract","url","persistentMount","type","parts","normalizePath","split","createPath","extractArchiveInCwd","Xhr","cache","responseType","fail","progress","total","loaded","onprogress","success","bytes","Uint8Array","_malloc","HEAPU8","set","retcode","_extract_zip","_free","writeOk","then","catch","mount","filesystems","IDBFS","syncfs","err","readOk","warn","createFile","file","body","ArrayBuffer","RegExp","filename","trim","createDataFile","begin","end","part","endsWith","substr","readed","readFile","js_dos_build_1","DosHost","wasmSupported","global","wdosboxPromise","WebAssembly","_typeof","instantiate","compile","wmodule","Module","of","Instance","polyfill","Math","imul","b","al","bl","fround","x","clz32","trunc","ceil","floor","resolveDosBox","WDOSBOX","ondosbox","instantiateWasm","compileDosBox","instance","message","fromIndex","lastIndexOf","wIndex","indexOf","isWasmUrl","compileWasmDosBox","compileJsDosBox","buildTotal","min","status","response","eval","wasmUrl","promise","onreject","reason","wasmModule","info","receiveInstance","env","globalscall","onglobals","apply","Host","js_dos_ci_1","js_dos_conf_1","js_dos_fs_1","js_dos_ui_1","DosModule","_super","isValid","ci","ui","tickListeners","pauseListeners","resumeListeners","terminateListeners","registerDefaultListeners","__extends","hidden","mozHidden","msHidden","webkitHidden","addEventListener","pause","resume","debug","dosbox","wdosboxUrl","console","DosUi","stage","SDL","defaults","widht","copyOnLock","discardOnLock","opaqueFrontBuffer","onRuntimeInitialized","main","detach","unshift","callMain","listener","registerResumeListener","l","DosOptions","DosBoxConfig","cycles","autolock","DosDom","__importStar","overlay","loaderMessage","overlayHtml","parentElement","container_1","replaceChild","container","childById","show","onprogressFallback","round","hide","setAttribute","parent","childElementCount","child","children","options","xhr","resource","method","makeHttpRequest","progressListner","errorListener","XMLHttpRequest","setRequestHeader","overrideMimeType","evt","onreadystatechange","onReadyStateChange","readyState","max","js_dos_cache_1","js_dos_host_1","js_dos_module_1","Dos","dosReadyPromise","assign","ready","runtime"],"mappings":"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","file":"js-dos.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","// Autogenerated\n// -------------\n// gulpfile.js --> generateBuildInfo\n\nexport const Build = {\n    version: \"6.22.44 (b45f7ff97d8d8bbe0414290d8a3f43c1)\",\n    jsVersion: \"1ca33ad2ba9ea3678b151078e40d1af354b306e9\",\n    wasmJsSize:  199660,\n    wasmVersion: \"ab1e5dfd0a5aa35a0ba806d5e2c8b3eb\",\n    wasmSize: 1809135,\n    jsSize:  6352779,\n};\n","import { ICache } from \"./js-dos-cache\";\n\nexport default class CacheDb implements ICache {\n\n    public version: string;\n    private storeName: string = \"files\";\n    private indexedDB: IDBFactory;\n    private db: IDBDatabase | null = null;\n\n    constructor(version: string, onready: (cache: ICache) => void, onerror: (msg: string) => void) {\n        this.version = version;\n        this.indexedDB = window.indexedDB || (window as any).mozIndexedDB\n            || (window as any).webkitIndexedDB || (window as any).msIndexedDB;\n\n        if (!this.indexedDB) {\n            onerror(\"Indexed db is not supported on this host\");\n            return;\n        }\n\n        const openRequest = this.indexedDB.open(\"js-dos-cache (\" + version + \")\", 1);\n        openRequest.onerror = (event) => {\n            onerror(\"Can't open cache database\");\n        };\n        openRequest.onsuccess = (event) => {\n            this.db = openRequest.result;\n            onready(this);\n        };\n        openRequest.onupgradeneeded = (event) => {\n            try {\n                this.db = openRequest.result;\n                this.db.onerror = (event) => {\n                    onerror(\"Can't upgrade cache database\");\n                };\n\n                this.db.createObjectStore(this.storeName);\n            } catch (e) {\n                onerror(\"Can't upgrade cache database\");\n            }\n        };\n    }\n\n    public put(key: string, data: any, onflush: () => void) {\n        if (this.db === null) {\n            onflush();\n            return;\n        }\n\n        const transaction = this.db.transaction(this.storeName, \"readwrite\");\n        transaction.oncomplete = () => onflush();\n        transaction.objectStore(this.storeName).put(data, key);\n    }\n\n    public get(key: string, ondata: (data: any) => void, onerror: (msg: string) => void) {\n        if (this.db === null) {\n            onerror(\"db is not initalized\");\n            return;\n        }\n\n        const transaction = this.db.transaction(this.storeName, \"readonly\");\n        const request = transaction.objectStore(this.storeName).get(key);\n        request.onerror = () => onerror(\"Can't read value for key '\" + key + \"'\");\n        request.onsuccess = () => {\n            if (request.result) {\n                ondata(request.result);\n            } else {\n                onerror(\"Result is empty for key '\" + key + \"', result: \" + request.result);\n            }\n        };\n    }\n\n    public forEach(each: (key: string, value: any) => void, onend: () => void) {\n        if (this.db === null) {\n            onend();\n            return;\n        }\n\n        const transaction = this.db.transaction(this.storeName, \"readonly\");\n        const request = transaction.objectStore(this.storeName).openCursor();\n        request.onerror = () => onend();\n        request.onsuccess = (event) => {\n            const cursor = (event.target as any).result as IDBCursorWithValue;\n            if (cursor) {\n                each(cursor.key.toString(), cursor.value);\n                cursor.continue();\n            } else {\n                onend();\n            }\n        };\n    }\n}\n","import { ICache } from \"./js-dos-cache\";\n\nexport default class CacheNoop implements ICache {\n    public put(key: string, data: any, onflush: () => void) {\n        // nothing\n    }\n\n    public get(key: string, ondata: (data: any) => void, onerror: (msg: string) => void) {\n        onerror(\"Cache is not supported on this host\");\n    }\n\n    public forEach(each: (key: string, value: any) => void, onend: () => void) {\n        onend();\n    }\n}\n","import CacheDb from \"./js-dos-cache-db\";\nimport CacheNoop from \"./js-dos-cache-noop\";\nimport { DosModule } from \"./js-dos-module\";\n\nexport interface ICache {\n    put: (key: string, data: any, onflush: () => void) => void;\n    get: (key: string, ondata: (data: any) => void, onerror: (msg: string) => void) => void;\n    forEach: (each: (key: string, value: any) => void, onend: () => void) => void;\n}\n\nexport default function openCache(module: DosModule, onready: (cache: ICache) => void) {\n    new CacheDb(module.version, onready, (msg: string) => {\n        if (module.log !== undefined) {\n            module.log(\"ERR! Can't initalize cache, cause: \" + msg);\n        }\n        onready(new CacheNoop());\n    });\n}\n","// # DosCommandInterface\n// Is abstraction that allows you to control runned instance of js-dos\nimport { DosModule } from \"./js-dos-module\";\n\nexport class DosCommandInterface {\n    public dos: DosModule;\n    private em: any; // typeof Module;\n    private api: LowLevelApi;\n    private onready: (ci: DosCommandInterface) => void;\n\n    private shellInputQueue: string[] = [];\n    private shellInputClients: Array<() => void> = [];\n\n    constructor(dos: DosModule, onready: (ci: DosCommandInterface) => void) {\n        this.dos = dos;\n        this.em = (dos as any);\n        this.api = (dos as any);\n        this.api.ping = (msg: string, ...args: any[]) => {\n            this.onping(msg, args);\n        };\n        this.onready = onready;\n    }\n\n    // * `width()` - return dosbox window width in pixels\n    public width() {\n        return this.dos.canvas.width;\n    }\n\n    // * `height()` - return dosbox window height in pixels\n    public height() {\n        return this.dos.canvas.height;\n    }\n\n    // * `fullscreen()` - enters fullscreen mode\n    // This function can be called anywhere, but for web security reasons its associated request can only be raised\n    // inside the event handler for a user-generated event (for example a key, mouse or touch press/release).\n    public fullscreen() {\n        this.dos.canvas.requestFullscreen()\n    }\n\n    // * `shell([cmd1, cmd2, ...])` - executes passed commands\n    // in dosbox shell if it's runned, returns Promise that\n    // resolves when commands sequence is executed\n    public shell(...cmd: string[]) {\n        if (cmd.length === 0) {\n            return;\n        }\n\n        return new Promise((resolve, reject) => {\n            this.shellInputClients.push(resolve);\n            for (const next of cmd) {\n                this.shellInputQueue.push(next);\n            }\n            this.requestShellInput();\n        });\n    }\n\n    // * `screenshot()` - get screnshot of canvas as ImageData\n    public screenshot() {\n        return new Promise((resolve) => {\n            this.api.send(\"screenshot\", \"\", (data) => {\n                resolve(data);\n            });\n        });\n    }\n\n    // * `exit()` - immediately exit from runtime\n    public exit() {\n        try {\n            this.dos.terminate();\n            this.api.send(\"exit\");\n        } catch (e) {\n            return 0;\n        }\n\n        this.dos.error(\"Runtime is still alive!\");\n        return -1;\n    }\n\n    // * `simulateKeyEvent(keyCode, pressed)` - allows to simulate key press OR release on js-dos canvas\n    public simulateKeyEvent(keyCode: number, pressed: boolean): void {\n        const name = pressed ? \"keydown\" : \"keyup\";\n        const event = document.createEvent(\"KeyboardEvent\") as any;\n        const getter: any = {\n            get() {\n                return this.keyCodeVal;\n            },\n        };\n\n        // Chromium Hack\n        Object.defineProperty(event, \"keyCode\", getter);\n        Object.defineProperty(event, \"which\", getter);\n        Object.defineProperty(event, \"charCode\", getter);\n\n        event.initKeyboardEvent\n        ? event.initKeyboardEvent(name, true, true, document.defaultView, false, false, false, false, keyCode, keyCode)\n        : event.initKeyEvent(name, true, true, document.defaultView, false, false, false, false, keyCode, 0);\n\n        event.keyCodeVal = keyCode;\n        this.dos.canvas && this.dos.canvas.dispatchEvent(event);\n    }\n\n    // * `simulateKeyPress(keyCode)` - allows to simulate key press AND release on js-dos canvas\n    public simulateKeyPress(keyCode: number): void {\n        this.simulateKeyEvent(keyCode, true);\n        setTimeout(() => this.simulateKeyEvent(keyCode, false), 100);\n    }\n\n    private sendKeyPress(code: number) {\n        this.api.send(\"sdl_key_event\", code + \"\");\n    }\n\n    private requestShellInput() {\n        this.sendKeyPress(13);\n    }\n\n    private onping(msg: string, args: any[]) {\n        switch (msg) {\n            case \"ready\":\n                this.onready(this);\n                break;\n            case \"frame\":\n                this.onframe();\n                break;\n            case \"shell_input\":\n                if (this.shellInputQueue.length === 0) {\n                    return;\n                }\n\n                const buffer: number = args[0];\n                const maxLength: number = args[1];\n\n                const cmd = this.shellInputQueue.shift();\n                const cmdLength = this.em.lengthBytesUTF8(cmd) + 1;\n\n                if (cmdLength > maxLength) {\n                    if (this.dos.onerror !== undefined) {\n                        this.dos.onerror(\"Can't execute cmd '\" + cmd +\n                            \"', because it's bigger then max cmd length \" + maxLength);\n                    }\n                    return;\n                }\n\n                this.em.stringToUTF8(cmd, buffer, cmdLength);\n\n                if (this.shellInputQueue.length === 0) {\n                    for (const resolve of this.shellInputClients) {\n                        resolve();\n                    }\n                    this.shellInputClients = [];\n                } else {\n                    this.requestShellInput();\n                }\n            default:\n            /* do nothing */\n        }\n    }\n\n    private onframe() {\n        this.dos.tick();\n    }\n}\n\ninterface LowLevelApi {\n    send: (event: string, msg?: any, callback?: (msg: string) => void) => void;\n    ping: (msg: string) => void;\n}\n","import { DosBoxConfig, DosBoxConfigDefaults } from \"./js-dos-options\";\n\n// # js-dos default config\n// This is default config for dosbox that applies for all runs.\n\n// It's configurable through [options](https://js-dos.com/6.22/docs/api/generate.html?page=js-dos-options)\nexport default function getJsDosConfig(config: DosBoxConfig): string {\n    let conf = jsdosconf;\n    function update(placeholder: string) {\n        conf = conf.replace(\"%\" + placeholder + \"%\",\n            ((config as any)[placeholder] || (DosBoxConfigDefaults as any)[placeholder]) + \"\");\n    }\n    Object.keys(DosBoxConfigDefaults).forEach((name) => update(name));\n    return conf;\n}\n\n/* tslint:disable:max-line-length */\nconst jsdosconf = `\n# This is the configurationfile for DOSBox 0.74. (Please use the latest version of DOSBox)\n# Lines starting with a # are commentlines and are ignored by DOSBox.\n# They are used to (briefly) document the effect of each option.\n\n[sdl]\n#       fullscreen: Start dosbox directly in fullscreen. (Press ALT-Enter to go back)\n#       fulldouble: Use double buffering in fullscreen. It can reduce screen flickering, but it can also result in a slow DOSBox.\n#   fullresolution: What resolution to use for fullscreen: original or fixed size (e.g. 1024x768).\n#                     Using your monitor's native resolution with aspect=true might give the best results.\n#                     If you end up with small window on a large screen, try an output different from surface.\n# windowresolution: Scale the window to this size IF the output device supports hardware scaling.\n#                     (output=surface does not!)\n#           output: What video system to use for output.\n#                   Possible values: surface, overlay, opengl, openglnb.\n#         autolock: Mouse will automatically lock, if you click on the screen. (Press CTRL-F10 to unlock)\n#      sensitivity: Mouse sensitivity.\n#      waitonerror: Wait before closing the console if dosbox has an error.\n#         priority: Priority levels for dosbox. Second entry behind the comma is for when dosbox is not focused/minimized.\n#                     pause is only valid for the second entry.\n#                   Possible values: lowest, lower, normal, higher, highest, pause.\n#       mapperfile: File used to load/save the key/event mappings from. Resetmapper only works with the defaul value.\n#     usescancodes: Avoid usage of symkeys, might not work on all operating systems.\n\nfullscreen=false\nfulldouble=false\nfullresolution=original\nwindowresolution=original\noutput=surface\nautolock=%autolock%\nsensitivity=100\nwaitonerror=true\npriority=higher,normal\nmapperfile=mapper-jsdos.map\nusescancodes=true\nvsync=false\n\n[dosbox]\n# language: Select another language file.\n#  machine: The type of machine tries to emulate.\n#           Possible values: hercules, cga, tandy, pcjr, ega, vgaonly, svga_s3, svga_et3000, svga_et4000, svga_paradise, vesa_nolfb, vesa_oldvbe.\n# captures: Directory where things like wave, midi, screenshot get captured.\n#  memsize: Amount of memory DOSBox has in megabytes.\n#             This value is best left at its default to avoid problems with some games,\n#             though few games might require a higher value.\n#             There is generally no speed advantage when raising this value.\n\nlanguage=\nmachine=svga_s3\ncaptures=capture\nmemsize=16\n\n[render]\n# frameskip: How many frames DOSBox skips before drawing one.\n#    aspect: Do aspect correction, if your output method doesn't support scaling this can slow things down!.\n#    scaler: Scaler used to enlarge/enhance low resolution modes.\n#              If 'forced' is appended, then the scaler will be used even if the result might not be desired.\n#            Possible values: none, normal2x, normal3x, advmame2x, advmame3x, advinterp2x, advinterp3x, hq2x, hq3x, 2xsai, super2xsai, supereagle, tv2x, tv3x, rgb2x, rgb3x, scan2x, scan3x.\n\nframeskip=0\naspect=false\nscaler=none\n\n[cpu]\n#      core: CPU Core used in emulation. auto will switch to dynamic if available and appropriate.\n#            Possible values: auto, dynamic, normal, simple.\n#   cputype: CPU Type used in emulation. auto is the fastest choice.\n#            Possible values: auto, 386, 386_slow, 486_slow, pentium_slow, 386_prefetch.\n#    cycles: Amount of instructions DOSBox tries to emulate each millisecond.\n#            Setting this value too high results in sound dropouts and lags.\n#            Cycles can be set in 3 ways:\n#              'auto'          tries to guess what a game needs.\n#                              It usually works, but can fail for certain games.\n#              'fixed #number' will set a fixed amount of cycles. This is what you usually need if 'auto' fails.\n#                              (Example: fixed 4000).\n#              'max'           will allocate as much cycles as your computer is able to handle.\n#\n#            Possible values: auto, fixed, max.\n#   cycleup: Amount of cycles to decrease/increase with keycombo.(CTRL-F11/CTRL-F12)\n# cycledown: Setting it lower than 100 will be a percentage.\n\ncore=auto\ncputype=auto\ncycles=%cycles%\ncycleup=10\ncycledown=20\n\n[mixer]\n#   nosound: Enable silent mode, sound is still emulated though.\n#      rate: Mixer sample rate, setting any device's rate higher than this will probably lower their sound quality.\n#            Possible values: 44100, 48000, 32000, 22050, 16000, 11025, 8000, 49716.\n# blocksize: Mixer block size, larger blocks might help sound stuttering but sound will also be more lagged.\n#            Possible values: 1024, 2048, 4096, 8192, 512, 256.\n# prebuffer: How many milliseconds of data to keep on top of the blocksize.\n\nnosound=false\nrate=44100\nblocksize=1024\nprebuffer=20\n\n[midi]\n#     mpu401: Type of MPU-401 to emulate.\n#             Possible values: intelligent, uart, none.\n# mididevice: Device that will receive the MIDI data from MPU-401.\n#             Possible values: default, win32, alsa, oss, coreaudio, coremidi, none.\n# midiconfig: Special configuration options for the device driver. This is usually the id of the device you want to use.\n#               See the README/Manual for more details.\n\nmpu401=intelligent\nmididevice=default\nmidiconfig=\n\n[sblaster]\n#  sbtype: Type of Soundblaster to emulate. gb is Gameblaster.\n#          Possible values: sb1, sb2, sbpro1, sbpro2, sb16, gb, none.\n#  sbbase: The IO address of the soundblaster.\n#          Possible values: 220, 240, 260, 280, 2a0, 2c0, 2e0, 300.\n#     irq: The IRQ number of the soundblaster.\n#          Possible values: 7, 5, 3, 9, 10, 11, 12.\n#     dma: The DMA number of the soundblaster.\n#          Possible values: 1, 5, 0, 3, 6, 7.\n#    hdma: The High DMA number of the soundblaster.\n#          Possible values: 1, 5, 0, 3, 6, 7.\n# sbmixer: Allow the soundblaster mixer to modify the DOSBox mixer.\n# oplmode: Type of OPL emulation. On 'auto' the mode is determined by sblaster type. All OPL modes are Adlib-compatible, except for 'cms'.\n#          Possible values: auto, cms, opl2, dualopl2, opl3, none.\n#  oplemu: Provider for the OPL emulation. compat might provide better quality (see oplrate as well).\n#          Possible values: default, compat, fast.\n# oplrate: Sample rate of OPL music emulation. Use 49716 for highest quality (set the mixer rate accordingly).\n#          Possible values: 44100, 49716, 48000, 32000, 22050, 16000, 11025, 8000.\n\nsbtype=sb16\nsbbase=220\nirq=7\ndma=1\nhdma=5\nsbmixer=true\noplmode=auto\noplemu=default\noplrate=44100\n\n[gus]\n#      gus: Enable the Gravis Ultrasound emulation.\n#  gusrate: Sample rate of Ultrasound emulation.\n#           Possible values: 44100, 48000, 32000, 22050, 16000, 11025, 8000, 49716.\n#  gusbase: The IO base address of the Gravis Ultrasound.\n#           Possible values: 240, 220, 260, 280, 2a0, 2c0, 2e0, 300.\n#   gusirq: The IRQ number of the Gravis Ultrasound.\n#           Possible values: 5, 3, 7, 9, 10, 11, 12.\n#   gusdma: The DMA channel of the Gravis Ultrasound.\n#           Possible values: 3, 0, 1, 5, 6, 7.\n# ultradir: Path to Ultrasound directory. In this directory\n#           there should be a MIDI directory that contains\n#           the patch files for GUS playback. Patch sets used\n#           with Timidity should work fine.\n\ngus=false\ngusrate=44100\ngusbase=240\ngusirq=5\ngusdma=3\nultradir=C:\\ULTRASND\n\n[speaker]\n# pcspeaker: Enable PC-Speaker emulation.\n#    pcrate: Sample rate of the PC-Speaker sound generation.\n#            Possible values: 44100, 48000, 32000, 22050, 16000, 11025, 8000, 49716.\n#     tandy: Enable Tandy Sound System emulation. For 'auto', emulation is present only if machine is set to 'tandy'.\n#            Possible values: auto, on, off.\n# tandyrate: Sample rate of the Tandy 3-Voice generation.\n#            Possible values: 44100, 48000, 32000, 22050, 16000, 11025, 8000, 49716.\n#    disney: Enable Disney Sound Source emulation. (Covox Voice Master and Speech Thing compatible).\n\npcspeaker=true\npcrate=44100\ntandy=auto\ntandyrate=44100\ndisney=true\n\n[joystick]\n# joysticktype: Type of joystick to emulate: auto (default), none,\n#               2axis (supports two joysticks),\n#               4axis (supports one joystick, first joystick used),\n#               4axis_2 (supports one joystick, second joystick used),\n#               fcs (Thrustmaster), ch (CH Flightstick).\n#               none disables joystick emulation.\n#               auto chooses emulation depending on real joystick(s).\n#               (Remember to reset dosbox's mapperfile if you saved it earlier)\n#               Possible values: auto, 2axis, 4axis, 4axis_2, fcs, ch, none.\n#        timed: enable timed intervals for axis. Experiment with this option, if your joystick drifts (away).\n#     autofire: continuously fires as long as you keep the button pressed.\n#       swap34: swap the 3rd and the 4th axis. can be useful for certain joysticks.\n#   buttonwrap: enable button wrapping at the number of emulated buttons.\n\njoysticktype=auto\ntimed=true\nautofire=false\nswap34=false\nbuttonwrap=false\n\n[serial]\n# serial1: set type of device connected to com port.\n#          Can be disabled, dummy, modem, nullmodem, directserial.\n#          Additional parameters must be in the same line in the form of\n#          parameter:value. Parameter for all types is irq (optional).\n#          for directserial: realport (required), rxdelay (optional).\n#                           (realport:COM1 realport:ttyS0).\n#          for modem: listenport (optional).\n#          for nullmodem: server, rxdelay, txdelay, telnet, usedtr,\n#                         transparent, port, inhsocket (all optional).\n#          Example: serial1=modem listenport:5000\n#          Possible values: dummy, disabled, modem, nullmodem, directserial.\n# serial2: see serial1\n#          Possible values: dummy, disabled, modem, nullmodem, directserial.\n# serial3: see serial1\n#          Possible values: dummy, disabled, modem, nullmodem, directserial.\n# serial4: see serial1\n#          Possible values: dummy, disabled, modem, nullmodem, directserial.\n\nserial1=dummy\nserial2=dummy\nserial3=disabled\nserial4=disabled\n\n[dos]\n#            xms: Enable XMS support.\n#            ems: Enable EMS support.\n#            umb: Enable UMB support.\n# keyboardlayout: Language code of the keyboard layout (or none).\n\nxms=true\nems=true\numb=true\nkeyboardlayout=auto\n\n[ipx]\n# ipx: Enable ipx over UDP/IP emulation.\n\nipx=false\n\n[autoexec]\n# Lines in this section will be run at startup.\n# You can put your MOUNT lines here.\n\n# https://js-dos.com\n# █▀▀▀▀▀█ █  ▄▄▄▀▀█ █▀▀▀▀▀█\n# █ ███ █ ██▄ █ ▀ ▄ █ ███ █\n# █ ▀▀▀ █ ▄██ ▀ ▀▀█ █ ▀▀▀ █\n# ▀▀▀▀▀▀▀ ▀ █▄▀▄▀ █ ▀▀▀▀▀▀▀\n# █▀▄▄█▀▀▄▄ ▀ ▀█▄▄▄▄ ▀▄█▀█▀\n# █▀ ▀ ▀▀▄ █▀ ▄ ▄▀▀▀▄ █▀█▄\n# ▄ ▄▄ █▀▀▄ ▄▀▄▀▀█  ▀▀▄▀▀█▀\n#   ▄▀▀█▀▀ █▀█▀█▀▀▄ ▀██▀█▄\n# ▀▀▀ ▀ ▀ █▄█ ▀█▄▄█▀▀▀█▀▀\n# █▀▀▀▀▀█ ▄▄▄ ▄ ▄ █ ▀ █▄▄▄▄\n# █ ███ █ ▀█▀▀▄▀▀▄████▀▀█▄█\n# █ ▀▀▀ █ ▄▀▀█▀█▀▄ ▀▀▄▄█▄█ \n# ▀▀▀▀▀▀▀ ▀   ▀▀ ▀  ▀   ▀▀▀\n`;\n","// # DosDom\n// Simple API to work with DOM\n\n// ### applyCss - add new css style if no html element with id exists\nexport function applyCss(id: string, css: string) {\n    if (document.getElementById(id) === null) {\n        const style = document.createElement(\"style\") as HTMLStyleElement;\n        style.id = id;\n        style.innerHTML = css;\n        document.head.appendChild(style);\n    }\n}\n\n// ### createDiv - typesafe shortcut for creating HTMLDivElement\nexport function createDiv(className?: string): HTMLDivElement {\n    const el = document.createElement(\"div\") as HTMLDivElement;\n    if (className !== undefined) {\n        el.className = className;\n    }\n    return el;\n}\n","// # DosFS\n// API for working with file system of dosbox\n\nimport CacheNoop from \"./js-dos-cache-noop\";\nimport { DosModule } from \"./js-dos-module\";\nimport { Xhr } from \"./js-dos-xhr\";\n\nexport class DosFS {\n    private dos: DosModule;\n    private em: any; // typeof Module;\n    private fs: any;\n    private syncingPromise: Promise<void> | null = null;\n    private lastSyncTime = 0;\n\n    constructor(dos: DosModule) {\n        this.dos = dos;\n        this.em = dos as any;\n        this.fs = (dos as any).FS;\n\n        // Sync fs to indexed db periodically\n        this.dos.registerTickListener(() => {\n            if (Date.now() - this.lastSyncTime < 5000) {\n                return;\n            }\n            this.lastSyncTime = Date.now();\n            this.syncFs();\n        });\n        this.dos.registerPauseListener(() => this.syncFs());\n        this.dos.registerTerminateListener(() => this.syncFs());\n    }\n\n    public chdir(path: string) {\n        this.fs.chdir(path);\n    }\n\n    // ### extract\n    public extract(url: string, persistentMount: string = \"/\", type: string = \"zip\") {\n        // download archive by given url and then extract it in cwd (cwd will be mounted as C:)\n        //\n        // * `url` - url for downloading archive\n        // * `persistentMount` - is a path to mount archive contents, by default mount point is '/' which\n        // is a MEMFS that is live only in one ssesion. It means that after restart all progress will be erased.\n        // If you set some path (any), then this path will be stored across sessions in indexed db. It means\n        // that progress will be there after browser restart.\n        // * `type` - archive type **only zip is supported**\n        //\n        // this method will return `Promise<void>`, that will be resolved\n        // on success with empty object or rejected\n\n        persistentMount = this.normalizePath(persistentMount);\n\n        const parts = persistentMount.split(\"/\");\n        this.createPath(parts, 0, parts.length);\n        this.chdir(persistentMount);\n\n        const extractArchiveInCwd = () => {\n            return new Promise<void>((resolve, reject) => {\n                if (type !== \"zip\") {\n                    reject(\"Only ZIP archive is supported\");\n                    return;\n                }\n\n                new Xhr(url, {\n                    cache: new CacheNoop(),\n                    responseType: \"arraybuffer\",\n                    fail: (msg) => reject(msg),\n                    progress: (total, loaded) => {\n                        if (this.dos.onprogress !== undefined) {\n                            this.dos.onprogress(\"Downloading \" + url, total, loaded);\n                        }\n                    },\n                    success: (data: ArrayBuffer) => {\n                        const bytes = new Uint8Array(data);\n                        const buffer = this.em._malloc(bytes.length);\n                        this.em.HEAPU8.set(bytes, buffer);\n                        const retcode = this.em._extract_zip(buffer, bytes.length);\n                        this.em._free(buffer);\n\n                        if (retcode === 0) {\n                            this.writeOk(persistentMount);\n                            this.syncFs().then(resolve).catch(reject);\n                        } else {\n                            reject(\"Can't extract zip, retcode \" + retcode + \", see more info in logs\");\n                        }\n                    },\n                });\n            });\n        };\n\n        if (persistentMount === \"/\" || persistentMount.length === 0) {\n            return extractArchiveInCwd();\n        }\n\n        return new Promise<void>((resolve, reject) => {\n            if (this.lastSyncTime > 0) {\n                reject(\"Can't create persistent mount point, after syncing process starts\");\n                return;\n            }\n\n            this.fs.mount(this.fs.filesystems.IDBFS, {}, persistentMount);\n            this.fs.syncfs(true, (err: any) => {\n                if (err) {\n                    reject(\"Can't restore FS from indexed db, cause: \" + err);\n                    return;\n                }\n\n                if (!this.readOk(persistentMount)) {\n                    this.dos.warn(\"Indexed db contains broken FS, resetting...\");\n                    extractArchiveInCwd().then(resolve).catch(reject);\n                    return;\n                }\n\n                resolve();\n            });\n        });\n    }\n\n    // ### createFile\n    public createFile(file: string, body: ArrayBuffer | Uint8Array | string) {\n        // [synchronous] allow to create file in FS, you can pass absolute path.\n        // All directories will be created\n        //\n        // body can be string or ArrayBuffer or Uint8Array\n\n        if (body instanceof ArrayBuffer) {\n            body = new Uint8Array(body);\n        }\n\n        // windows style path are also valid, but **drive letter is ignored**\n        // if you pass only filename, then file will be writed in root \"/\" directory\n        file = file.replace(new RegExp(\"^[a-zA-z]+:\"), \"\") .replace(new RegExp(\"\\\\\\\\\", \"g\"), \"/\");\n        const parts = file.split(\"/\");\n\n        if (parts.length === 0) {\n            if (this.dos.onerror !== undefined) {\n                this.dos.onerror(\"Can't create file '\" + file + \"', because it's not valid file path\");\n            }\n            return;\n        }\n\n        const filename = parts[parts.length - 1].trim();\n\n        if (filename.length === 0) {\n            if (this.dos.onerror !== undefined) {\n                this.dos.onerror(\"Can't create file '\" + file + \"', because file name is empty\");\n            }\n            return;\n        }\n\n        /* i < parts.length - 1, because last part is file name */\n        const path = this.createPath(parts, 0, parts.length - 1);\n        this.fs.createDataFile(path, filename, body, true, true, true);\n    }\n\n    private createPath(parts: string[], begin: number, end: number) {\n        let path = \"\";\n        for (let i = begin; i < end; ++i) {\n            const part = parts[i].trim();\n            if (part.length === 0) {\n                continue;\n            }\n\n            this.fs.createPath(path, part, true, true);\n            path = path + \"/\" + part;\n        }\n\n        return path;\n    }\n\n    private syncFs() {\n        if (this.syncingPromise) {\n            return this.syncingPromise;\n        }\n\n        this.syncingPromise = new Promise<void>((resolve, reject) => {\n            const startedAt = Date.now();\n            this.fs.syncfs(false, (err: any) => {\n                if (err) {\n                    this.dos.error(\"Can't sync FS to indexed db, cause: \" + err);\n                    reject(err);\n                }\n                this.syncingPromise = null;\n                this.lastSyncTime = Date.now();\n                resolve();\n            });\n        });\n\n        return this.syncingPromise;\n    }\n\n    private normalizePath(path: string) {\n        if (path.length === 0 || path[0] !== \"/\") {\n            path = \"/\" + path;\n        }\n\n        if (path.length > 1 && path.endsWith(\"/\")) {\n            path = path.substr(0, path.length - 1);\n        }\n\n        return path;\n    }\n\n    private readOk(path: string) {\n        try {\n            const readed = this.fs.readFile(path + \"/state.fs\");\n            return readed[0] === 79 && readed[1] === 70;\n        } catch {\n            return false;\n        }\n    }\n\n    private writeOk(path: string) {\n        this.createFile(path + \"/state.fs\", new Uint8Array([79, 70])); // Ok\n    }\n\n}\n","// # DosHost\n// This class is used to detect and provide information about\n// features that supported in current environment\n\n/* tslint:disable:member-ordering */\nimport { Build } from \"./js-dos-build\";\nimport { ICache } from \"./js-dos-cache\";\nimport { DosModule } from \"./js-dos-module\";\nimport { Xhr } from \"./js-dos-xhr\";\n\nclass DosHost {\n\n    public wasmSupported = false;\n    public global = window as any;\n\n    private wdosboxPromise: Promise<any> | null = null;\n\n    constructor() {\n        this.global.exports = {};\n\n        // ### WebAssembly\n        // Host able to detect is WebAssembly supported or not,\n        // this information is stored in `Host.wasmSupported` variable\n        try {\n            if (typeof WebAssembly === \"object\" &&\n                typeof WebAssembly.instantiate === \"function\" &&\n                typeof WebAssembly.compile === \"function\") {\n\n                const wmodule = new WebAssembly.Module(Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00));\n                if (wmodule instanceof WebAssembly.Module) {\n                    this.wasmSupported = new WebAssembly.Instance(wmodule) instanceof WebAssembly.Instance;\n                }\n            }\n        } catch (error) {\n            /* do nothing WebAssembly is not supported */\n        }\n\n        // ### polyfill\n        // Host also provides limited set of polyfills to support legacy browsers\n        this.polyfill();\n    }\n\n    // Currently polyfill contains implementations for:\n    // `Math.imul`, `Math.fround`, `Math.clz32`, `Math.trunc`\n    /* tslint:disable:no-bitwise */\n    /* tslint:disable:only-arrow-functions */\n    private polyfill() {\n        if (!Math.imul || Math.imul(0xffffffff, 5) !== -5) {\n            Math.imul = function imul(a: any, b: any) {\n                const ah = a >>> 16;\n                const al = a & 0xffff;\n                const bh = b >>> 16;\n                const bl = b & 0xffff;\n                return (al * bl + ((ah * bl + al * bh) << 16)) | 0;\n            };\n        }\n        Math.imul = Math.imul;\n\n        if (!Math.fround) {\n            Math.fround = function(x) { return x; };\n        }\n        Math.fround = Math.fround;\n\n        if (!Math.clz32) {\n            Math.clz32 = function(x) {\n                x = x >>> 0;\n                for (let i = 0; i < 32; i++) {\n                    if (x & (1 << (31 - i))) { return i; }\n                }\n                return 32;\n            };\n        }\n        Math.clz32 = Math.clz32;\n\n        if (!Math.trunc) {\n            Math.trunc = function(x) {\n                return x < 0 ? Math.ceil(x) : Math.floor(x);\n            };\n        }\n        Math.trunc = Math.trunc;\n    }\n\n    // ### resolveDosBox\n    // `resolveDosBox` is another important task of DosHost\n    public resolveDosBox(url: string, cache: ICache, module: DosModule) {\n        // When dosbox is resolved, WDOSBOX module is set to\n        // global variable `exports.WDOSBOX`. This variable is\n        // used to prevent next loads of same dosbox module.\n        if (this.global.exports.WDOSBOX) {\n            module.ondosbox(this.global.exports.WDOSBOX, this.global.exports.instantiateWasm);\n            return;\n        }\n\n        if (this.wdosboxPromise === null) {\n            this.wdosboxPromise = this.compileDosBox(url, cache, module);\n        }\n\n        this.wdosboxPromise.then((instance: any) => {\n            /* leave promise scope */\n            const fn = () => {\n                this.wdosboxPromise = null;\n                module.ondosbox(this.global.exports.WDOSBOX, this.global.exports.instantiateWasm);\n            };\n            setTimeout(fn, 1);\n        }, (message: string) => {\n            /* leave promise scope */\n            const fn = () => {\n                this.wdosboxPromise = null;\n                if (module.onerror !== undefined) {\n                    module.onerror(message);\n                }\n            };\n            setTimeout(fn, 1);\n        });\n    }\n\n    // If dosbox is not yet resolved, then:\n    private compileDosBox(url: string, cache: ICache, module: DosModule) {\n        const fromIndex = url.lastIndexOf(\"/\");\n        const wIndex = url.indexOf(\"w\", fromIndex);\n        const isWasmUrl = wIndex === fromIndex + 1 && wIndex >= 0;\n\n        if (this.wasmSupported && isWasmUrl) {\n            return this.compileWasmDosBox(url, cache, module);\n        } else {\n            if (module.log) {\n                module.log(\"[WARN] Using js version of dosbox, perfomance can be lower then expected\");\n                module.log(\"[DEBUG] Wasm supported: \" + this.wasmSupported + \", url: \" + url);\n            }\n\n            // fallback to js version if wasm not supported\n            if (isWasmUrl) {\n                url = url.substr(0, wIndex) + url.substr(wIndex + 1);\n            }\n            return this.compileJsDosBox(url, cache, module);\n        }\n    }\n\n    private compileJsDosBox(url: string, cache: ICache, module: DosModule): Promise<any> {\n        return new Promise((resolve, reject) => {\n            const buildTotal = Build.jsSize;\n            const memUrl = url.replace(\".js\", \".js.mem\");\n\n            // * Host download `dosbox`js\n            new Xhr(url, {\n                cache,\n                progress: (total, loaded) => {\n                    if (module.onprogress) {\n                        module.onprogress(\"Resolving DosBox\", buildTotal,\n                        Math.min(buildTotal, loaded));\n                    }\n                },\n                fail: (url: string, status: number, message: string) => {\n                    reject(\"Can't download dosbox.js, code: \" + status +\n                        \", message: \" + message + \", url: \" + url);\n                },\n                success: (response: string) => {\n                    if (module.onprogress !== undefined) {\n                        module.onprogress(\"Resolving DosBox\", buildTotal, buildTotal);\n                    }\n\n                    response +=\n                        /* tslint:disable:no-eval */\n                        eval.call(this, response);\n                        /* tslint:enable:no-eval */\n\n                    resolve(this.global.exports.WDOSBOX);\n                },\n            });\n        });\n    }\n\n    private compileWasmDosBox(url: string, cache: ICache, module: DosModule): Promise<any> {\n        return new Promise((resolve, reject) => {\n            const buildTotal = Build.wasmSize + Build.wasmJsSize;\n            const wasmUrl = url.replace(\".js\", \".wasm.js\");\n\n            // * Host downloads `wdosbox` asm + js scripts\n            new Xhr(wasmUrl, {\n                cache,\n                responseType: \"arraybuffer\",\n                progress: (total, loaded) => {\n                    if (module.onprogress) {\n                        module.onprogress(\"Resolving DosBox\", buildTotal, Math.min(Build.wasmSize, loaded));\n                    }\n                },\n                fail: (url: string, status: number, message: string) => {\n                    reject(\"Can't download wasm, code: \" + status +\n                        \", message: \" + message + \", url: \" + url);\n                },\n                success: (response: any) => {\n                    // * Compile dosbox wasm module\n                    const promise = WebAssembly.compile(response);\n                    const onreject = (reason: any) => {\n                        reject(reason + \"\");\n                    };\n                    promise.catch(onreject);\n                    promise.then((wasmModule) => {\n                        this.global.exports.instantiateWasm = (info: any, receiveInstance: any) => {\n                            info.env.globalscall = (...args: any[]) => {\n                                if (module.onglobals) {\n                                    module.onglobals.apply(null, args);\n                                }\n                            };\n                            // *  Instaniate it for each new dosbox runtime\n                            return WebAssembly.instantiate(wasmModule, info)\n                                .catch(onreject)\n                                .then((instance) => {\n                                    receiveInstance(instance, wasmModule);\n                                });\n                        };\n\n                        new Xhr(url, {\n                            cache,\n                            progress: (total, loaded) => {\n                                if (module.onprogress) {\n                                    module.onprogress(\"Resolving DosBox\", buildTotal,\n                                        Math.min(buildTotal, Build.wasmSize + loaded));\n                                }\n                            },\n                            fail: (url: string, status: number, message: string) => {\n                                reject(\"Can't download wdosbox.js, code: \" + status +\n                                    \", message: \" + message + \", url: \" + url);\n                            },\n                            success: (response: string) => {\n                                if (module.onprogress !== undefined) {\n                                    module.onprogress(\"Resolving DosBox\", buildTotal, buildTotal);\n                                }\n\n                                response +=\n                                /* tslint:disable:no-eval */\n                                eval.call(window, response);\n                                /* tslint:enable:no-eval */\n                                resolve(this.global.exports.WDOSBOX);\n                            },\n                        });\n                    });\n                },\n            });\n        });\n    }\n\n}\n\nexport const Host = new DosHost();\n","// # DosModule\n// DosModule is [emscripten module object](https://kripken.github.io/emscripten-site/docs/api_reference/module.html),\n// with additional functionality\nimport { DosRuntime } from \"./js-dos\";\nimport { Build } from \"./js-dos-build\";\nimport { DosCommandInterface } from \"./js-dos-ci\";\nimport getJsDosConfig from \"./js-dos-conf\";\nimport { DosFS } from \"./js-dos-fs\";\nimport { DosOptions } from \"./js-dos-options\";\nimport { DosUi } from \"./js-dos-ui\";\n\nexport class DosModule extends DosOptions {\n    public isValid: boolean = false;\n    public canvas: HTMLCanvasElement;\n    public version = Build.version;\n    public onglobals?: (...args: any[]) => void;\n\n    private ci: Promise<DosCommandInterface> | null = null;\n    private instance: any;\n    private fs: DosFS | null = null;\n    private ui: DosUi | null = null;\n    private onready: (runtime: DosRuntime) => void;\n\n    private tickListeners: Array< () => void > = [];\n    private pauseListeners: Array< () => void > = [];\n    private resumeListeners: Array< () => void > = [];\n    private terminateListeners: Array< () => void > = [];\n\n    constructor(canvas: HTMLCanvasElement, onready: (runtime: DosRuntime) => void) {\n        super();\n        this.canvas = canvas;\n        this.onready = onready;\n\n        this.registerDefaultListeners();\n    }\n\n    private registerDefaultListeners() {\n        let hidden: string;\n        let visibilityChange: string;\n\n        if (typeof document.hidden !== \"undefined\") {\n            hidden = \"hidden\";\n            visibilityChange = \"visibilitychange\";\n        } else if (typeof (document as any).mozHidden !== \"undefined\") {\n            hidden = \"mozHidden\";\n            visibilityChange = \"mozvisibilitychange\";\n        } else if (typeof (document as any).msHidden !== \"undefined\") {\n            hidden = \"msHidden\";\n            visibilityChange = \"msvisibilitychange\";\n        } else if (typeof (document as any).webkitHidden !== \"undefined\") {\n            hidden = \"webkitHidden\";\n            visibilityChange = \"webkitvisibilitychange\";\n        }\n\n        document.addEventListener(\"visibilityChange\", () => {\n            (document as any)[hidden] ? this.pause() : this.resume();\n        }, false);\n\n        window.addEventListener(\"beforeunload\", () => {\n           this.terminate();\n        });\n    }\n\n    // ### logging\n    // DosModule implements simply logging features:\n    // `debug`, `info`, `warn`, `error` methods\n    public debug(message: string) {\n        if (this.log !== undefined) {\n            this.log(\"[DEBUG] \" + message);\n        }\n    }\n\n    public info(message: string) {\n        if (this.log !== undefined) {\n            this.log(\"[INFO] \" + message);\n        }\n    }\n\n    public warn(message: string) {\n        if (this.log !== undefined) {\n            this.log(\"[WARN] \" + message);\n        }\n    }\n\n    public error(message: string) {\n        if (this.log !== undefined) {\n            this.log(\"[ERROR] \" + message);\n        }\n    }\n\n    // ### ondosbox\n    public ondosbox(dosbox: any, instantiateWasm: any) {\n        this.info(\"DosBox resolved\");\n        (this as any).instantiateWasm = instantiateWasm;\n        this.instance = new dosbox(this);\n    }\n\n    // Method `ondosbox` is called when\n    // [Host](https://js-dos.com/6.22/docs/api/generate.html?page=js-dos-host) is resolved.\n    // This method instaniate wasm dosbox module with `this` as emscripten\n    // module object. It means that emscripten will call\n    // `this.onRuntimeInitialized` when runtime will be ready\n\n    public resolve() {\n        if (!this.wdosboxUrl) {\n            this.wdosboxUrl = \"wdosbox.js\";\n        }\n\n        if (!this.log) {\n            /* tslint:disable:no-console */\n            this.log = (message: string) => console.log(message);\n        }\n\n        if (!this.canvas) {\n            if (this.onerror !== undefined) {\n                this.onerror(\"canvas field is required, but not set!\");\n            }\n            return;\n        }\n\n        if (!this.onprogress) {\n            this.ui = new DosUi(this);\n            this.onprogress = (stage, total, loaded) => {\n                if (this.ui !== null) {\n                    this.ui.onprogress(stage, total, loaded);\n                }\n            };\n        }\n\n        // ### sdl defaults\n        // DosModule overrides defaults for emscripten SDL wrapper\n        // for maximum performance\n        (this as any).SDL = {\n            defaults: {\n                widht: 320,\n                height: 200,\n                copyOnLock: false,\n                discardOnLock: true,\n                opaqueFrontBuffer: false,\n            },\n        };\n\n        this.isValid = true;\n    }\n\n    // ### onRuntimeInitialized\n    public onRuntimeInitialized() {\n        const mainFn = (args?: string[]) => {\n            // When emscripten runtime is initialized and main\n            // function is called:\n            //\n            // * DosModule detach [auto ui](https://js-dos.com/6.22/docs/api/generate.html?page=js-dos-ui)\n            if (this.ui !== null) {\n                this.ui.detach();\n                this.ui = null;\n            }\n\n            if (!args) {\n                args = [];\n            }\n\n            if (this.fs === null) {\n                return new Promise<DosCommandInterface>((resolve, reject) => {\n                    reject(\"IllegalState: fs is null\");\n                });\n            }\n\n            this.fs.chdir(\"/\");\n\n            // * Write default [dosbox.conf](https://js-dos.com/6.22/docs/api/generate.html?page=js-dos-conf)\n            // file to user directory\n            this.fs.createFile(\"/home/web_user/.dosbox/dosbox-jsdos.conf\", getJsDosConfig(this));\n            // * Mount emscripten FS as drive c:\n            args.unshift(\"-userconf\", \"-c\", \"mount c .\", \"-c\", \"c:\");\n            // * Run dosbox with passed arguments and resolve\n            // [DosCommandInterface](https://js-dos.com/6.22/docs/api/generate.html?page=js-dos-ci)\n            (this as any).callMain(args);\n            return new Promise<DosCommandInterface>((resolve) => {\n                new DosCommandInterface(this, (ci: DosCommandInterface) => {\n                    resolve(ci);\n                });\n            });\n        };\n        this.fs = new DosFS(this);\n        this.onready({\n            fs: this.fs,\n            main: mainFn,\n        });\n    }\n\n    // ### registerTickListener\n    // registred tick listener it will be called each frame\n    public registerTickListener(listener: () => void) {\n        this.tickListeners.push(listener);\n    }\n\n    // ### registerPauseListener\n    // registred tick listener it will be called each frame\n    public registerPauseListener(listener: () => void) {\n        this.pauseListeners.push(listener);\n    }\n\n    // ### registerResumeListener\n    // registred tick listener it will be called each frame\n    public registerResumeListener(listener: () => void) {\n        this.resumeListeners.push(listener);\n    }\n\n    // ### registerTerminateListener\n    // registred tick listener it will be called each frame\n    public registerTerminateListener(listener: () => void) {\n        this.terminateListeners.push(listener);\n    }\n\n    // ### tick\n    // tick is called internally each frame, no need to call\n    // it manually\n    public tick() {\n        for (const l of this.tickListeners) {\n            l();\n        }\n    }\n\n    // ### pause\n    // pause is called when dosbox tab became inactive\n    public pause() {\n        for (const l of this.pauseListeners) {\n            l();\n        }\n    }\n\n    // ### tick\n    // resume is called when dosbox tab became active\n    public resume() {\n        for (const l of this.resumeListeners) {\n            l();\n        }\n    }\n\n    // ### tick\n    // terminate is called when dosbox tab is closed\n    public terminate() {\n        for (const l of this.terminateListeners) {\n            l();\n        }\n    }\n\n}\n","// # DosOptions\n// Is a options object that you pass to constructor of\n// [Dos](https://js-dos.com/6.22/docs/api/generate.html?page=js-dos)\n// class, to configure emulation layer\n\nexport class DosBoxConfig {\n// ### cycles\n    public cycles?: number | string;\n//    Amount of instructions DOSBox tries to emulate each millisecond.\n//    Setting this value too high results in sound dropouts and lags.\n//\n//    Cycles can be set in 3 ways:\n//\n//    * `auto` - tries to guess what a game needs. It usually works, but can fail for certain games.\n//    * `fixed #number` - will set a fixed amount of cycles. This is what you \n// usually need if 'auto' fails. (Example: fixed 4000).\n//    * `max` - will allocate as much cycles as your computer is able to handle.\n//\n\n// ### autolock\n    public autolock?: boolean;\n//    Mouse will automatically lock, if you click on the screen. (Press CTRL-F10 to unlock)\n//\n//    By default dosbox mouse will follow browser cursor without locking.\n//    It means that js-dos will not take exclusive control over mouse pointer.\n//    However you can change this behaviour by providing `autolock=true` in\n//    `dosbox.conf` or throug h [DosOptions](https://js-dos.com/6.22/docs/api/generate.html?page=js-dos-options).\n//    Then js-dos will take exclusive control and lock mouse inside js-dos container (you can't leave it).\n//    This will happen after first click, and you can unlock mouse by pressing `CTRL+F10` or `ESC`.\n//\n}\n\n// tslint:disable-next-line:max-classes-per-file\nexport class DosOptions extends DosBoxConfig {\n\n    // ### onprogress\n    public onprogress?: (stage: string, total: number, loaded: number) => void;\n    // progress event listener, it is fired when loading progress is changed\n    // if this function is not set, then\n    // [auto ui](https://js-dos.com/6.22/docs/api/generate.html?page=js-dos-ui) will be used\n    // to show progress\n    //\n    // * `stage` - current loading stage\n    // * `total` - total bytes to download on current stage\n    // * `loaded` - downloaded bytes\n\n    // ### onerror\n    public onerror?: (message: string) => void;\n    // this function is called when error happens\n    //\n    // * `message` - infomation about error\n\n    // ### log\n    public log?: (message: string) => void;\n    // you can provide log function, to override logging, by default js-dos uses console.log as implementation\n\n    // ### wdosboxUrl\n    public wdosboxUrl?: string;\n    // you can set alternative url for downloading js-dos script, default is `wdosbox.js`.\n    // Additionaly you can change which variant of js-dos script to use:\n    //\n    // * `wdosbox.js` - default variant. This version compiled with latest emscripten and in theory should work best\n    // * `wdosbox-emterp.js` - This version compiled with legacy fastcomp backend, can be useful in rare cases\n    // (e.g. if you have problems with default version)\n    // * `wdosbox-nosync.js` - Fastest possible version, but limited. You can't run console programs/shell\n    // emulation using it\n    // * `dosbox.js` - same as dosbox-emterp.js because default version can't be compiled to asm.js\n    // * `dosbox-emterp.js` - same as wdosbox-emterp.js but javascript (asm.js)\n    // * `dosbox-nosync.js` - same as wdosbox-nosync.js but javascript (asm.js)\n    //\n    // Take in account even if you use wasm version of dosbox it will be automatically fallbacked\n    // to javascript version if wasm can't start.\n    //\n    // Default version have limitation and can't be compiled to asm.js, dosbox-emterp.js will be used as fallback\n    // for wdosbox.js\n}\n\nexport const DosBoxConfigDefaults: DosBoxConfig = {\n    cycles: \"auto\",\n    autolock: false,\n};\n","// # JsDosUi\n// Optional ui module for js-dos.\n// This ui will be applied if client did not set `onprogress` in\n// [DosOptions](https://js-dos.com/6.22/docs/api/generate.html?page=js-dos-options)\nimport * as DosDom from \"./js-dos-dom\";\nimport { DosModule } from \"./js-dos-module\";\n\nconst maxStageLength = 32;\nexport class DosUi {\n    private canvas: HTMLCanvasElement;\n    private dos: DosModule;\n\n    private overlay: HTMLDivElement | null = null;\n    private loaderMessage: HTMLDivElement | null = null;\n    private hidden: boolean = true;\n\n    constructor(dos: DosModule) {\n        this.dos = dos;\n        this.canvas = dos.canvas;\n\n        // ### How it works\n        // This ui replace canvas element with div .dosbox-container,\n        // that contains original canvas and .dosbox-overlay as children\n        // You can change style of ui by editing css for this two classes\n\n        try {\n            DosDom.applyCss(\"js-dos-ui-css\", this.css);\n\n            if (this.canvas.parentElement !== null && this.canvas.parentElement.className !== \"dosbox-container\") {\n                const container = DosDom.createDiv(\"dosbox-container\");\n\n                const parent = this.canvas.parentElement;\n                parent.replaceChild(container, this.canvas);\n                container.appendChild(this.canvas);\n\n                const overlay = DosDom.createDiv(\"dosbox-overlay\");\n                container.appendChild(overlay);\n\n                overlay.innerHTML = this.overlayHtml;\n            }\n\n            const container = this.canvas.parentElement;\n            if (container === null) {\n                throw new Error(\"Illegal state, container is null\");\n            }\n            this.overlay = this.childById(container, \"dosbox-overlay\");\n            if (this.overlay === null) {\n                throw new Error(\"Illegal state, overlay is null\");\n            }\n            this.loaderMessage = this.childById(this.overlay, \"dosbox-loader-message\");\n\n            this.hidden = true;\n            this.show();\n        } catch (e) {\n            this.onprogress = this.onprogressFallback;\n        }\n    }\n\n    public onprogress(stage: string, total: number, loaded: number) {\n        if (stage.length > maxStageLength) {\n            stage = \"…\" + stage.substr(-maxStageLength);\n        }\n\n        const message = stage + \" \" + Math.round(loaded * 100 / total * 10) / 10 + \"%\";\n        if (this.loaderMessage !== null) {\n            this.loaderMessage.innerHTML = message;\n        }\n        this.dos.info(message);\n\n        if (loaded >= total) {\n            this.hide();\n        } else {\n            this.show();\n        }\n    }\n\n    public detach() {\n        this.hide();\n        this.onprogress = this.onprogressFallback;\n    }\n\n    public hide() {\n        if (this.hidden) {\n            return;\n        }\n        this.hidden = true;\n        if (this.overlay !== null) {\n            this.overlay.setAttribute(\"style\", \"display: none\");\n        }\n    }\n\n    public show() {\n        if (!this.hidden) {\n            return;\n        }\n        this.hidden = false;\n        if (this.overlay !== null) {\n            this.overlay.setAttribute(\"style\", \"display: block\");\n        }\n    }\n\n    private onprogressFallback(stage: string, total: number, loaded: number) {\n        this.dos.info(stage + \" \" + loaded * 100 / total + \"%\");\n    }\n\n    private childById(parent: Element, className: string): HTMLDivElement | null {\n        if (parent === null) {\n            return null;\n        }\n\n        for (let i = 0; i < parent.childElementCount; ++i) {\n            let child: HTMLElement | null = parent.children[i] as HTMLElement;\n            if (child.className === className) {\n                return child as HTMLDivElement;\n            }\n\n            child = this.childById(child, className);\n            if (child !== null) {\n                return child as HTMLDivElement;\n            }\n        }\n\n        return null;\n    }\n\n    // ### Style\n    /* tslint:disable:member-ordering */\n    /* tslint:disable:max-line-length */\n    private css: string = `\n    .dosbox-container { position: relative; min-width: 320px; min-height: 200px; display: inline-block; }\n    .dosbox-overlay, .dosbox-loader { position: absolute; left: 0; right: 0; top: 0; bottom: 0; background-color: rgba(51, 51, 51, 0.7); }\n    .dosbox-start { text-align: center; position: absolute; left: 0; right: 0; bottom: 50%; color: #fff; font-size: 1.5em; text-decoration: underline; cursor: pointer; }\n    .dosbox-overlay a { color: #fff; }\n    .dosbox-powered { position: absolute; right: 1em; bottom: 1em; font-size: 0.8em; color: #9C9C9C; }\n    .dosbox-loader-message { text-align: center; position: absolute; left: 0; right: 0; bottom: 50%; margin: 0 0 -3em 0; box-sizing: border-box; color: #fff; font-size: 1.5em; }\n    @-moz-keyframes loading { 0% { left: 0; } 50% { left: 8.33333em; } 100% { left: 0; } } @-webkit-keyframes loading { 0% { left: 0; } 50% { left: 8.33333em; } 100% { left: 0; } } @keyframes loading { 0% { left: 0; } 50% { left: 8.33333em; } 100% { left: 0; } } .st-loader { width: 10em; height: 2.5em; position: absolute; top: 50%; left: 50%; margin: -1.25em 0 0 -5em; box-sizing: border-box; }\n    .st-loader:before, .st-loader:after { content: \"\"; display: block; position: absolute; top: 0; bottom: 0; width: 1.25em; box-sizing: border-box; border: 0.25em solid #fff; }\n    .st-loader:before { left: -0.76923em; border-right: 0; }\n    .st-loader:after { right: -0.76923em; border-left: 0; }\n    .st-loader .equal { display: block; position: absolute; top: 50%; margin-top: -0.5em; left: 4.16667em; height: 1em; width: 1.66667em; border: 0.25em solid #fff; box-sizing: border-box; border-width: 0.25em 0; -moz-animation: loading 1.5s infinite ease-in-out; -webkit-animation: loading 1.5s infinite ease-in-out; animation: loading 1.5s infinite ease-in-out; background: #fff; }\n    `;\n\n    // ### Template\n    /* tslint:disable:member-ordering */\n    /* tslint:disable:max-line-length */\n    private overlayHtml: string = `\n        <div class=\"dosbox-loader\">\n            <div class=\"st-loader\">\n                <span class=\"equal\"></span>\n            </div>\n            <div class=\"dosbox-loader-message\"></div>\n        </div>\n        <div class=\"dosbox-powered\">\n            Powered by &nbsp;<a href=\"https://js-dos.com\">js-dos.com</a> (6.22)\n        </div>\n    `;\n}\n","import { ICache } from \"./js-dos-cache\";\nimport CacheNoop from \"./js-dos-cache-noop\";\n\n// # Xhr\n// `Xhr` is small wrapper over XMLHttpRequest, that provides some\n// handy methods\n\n// You can configre Xhr with XhrOptions object:\ninterface XhrOptions {\n    cache: ICache;\n    method?: string;\n    success?: (response: any) => void;\n    progress?: (total: number, loaded: number) => void;\n    fail?: (url: string, status: number, message: string) => void;\n    data?: string;\n    responseType?: XMLHttpRequestResponseType;\n}\n// * `method` - \"GET\" | \"POST\"\n// * `success` - callback when resource is downloaded\n// * `progress` - callback for progress\n// * `fail` - fail callback\n// * `data` - data for POST request, should typeof `application/x-www-form-urlencoded`\n// * `responseType` - XMLHttpRequestResponseType\n\n// Class Xhr does not have any public methods\nexport class Xhr {\n    private cache: ICache;\n    private resource: string;\n    private options: XhrOptions;\n    private xhr: XMLHttpRequest | null = null;\n    private total: number = 0;\n    private loaded: number = 0;\n\n    constructor(url: string, options: XhrOptions) {\n        this.resource = url;\n        this.options = options;\n        this.options.method = options.method || \"GET\";\n        this.cache = options.cache || new CacheNoop();\n\n        if (this.options.method  === \"GET\") {\n            this.cache.get(this.resource, (data) => {\n                if (this.options.success !== undefined) {\n                    this.options.success(data);\n                }\n            }, () => {\n                this.makeHttpRequest();\n            });\n        }\n    }\n\n    private makeHttpRequest() {\n        this.xhr = new XMLHttpRequest();\n        this.xhr.open(this.options.method || \"GET\", this.resource, true);\n        if (this.options.method === \"POST\") {\n            this.xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n        }\n        this.xhr.overrideMimeType(\"text/plain; charset=x-user-defined\");\n\n        let progressListner;\n        if (typeof (progressListner = this.xhr).addEventListener === \"function\") {\n            progressListner.addEventListener(\"progress\", (evt) => {\n                this.total = evt.total;\n                this.loaded = evt.loaded;\n                if (this.options.progress) {\n                    return this.options.progress(evt.total, evt.loaded);\n                }\n            });\n        }\n\n        let errorListener;\n        if (typeof (errorListener = this.xhr).addEventListener === \"function\") {\n            errorListener.addEventListener(\"error\", (evt) => {\n                if (this.options.fail) {\n                    this.options.fail(this.resource, (this.xhr as XMLHttpRequest).status, \"connection problem\");\n                    return delete this.options.fail;\n                }\n            });\n        }\n        this.xhr.onreadystatechange = () => {\n            return this.onReadyStateChange();\n        };\n        if (this.options.responseType) {\n            this.xhr.responseType = this.options.responseType;\n        }\n        this.xhr.send(this.options.data);\n    }\n\n    private onReadyStateChange() {\n        const xhr = (this.xhr as XMLHttpRequest);\n        if (xhr.readyState === 4) {\n            if (xhr.status === 200) {\n                if (this.options.success) {\n                    const total = Math.max(this.total, this.loaded);\n                    if (this.options.progress !== undefined) {\n                        this.options.progress(total, total);\n                    }\n\n                    if (this.options.method === \"GET\" && this.resource.indexOf(\"?\") < 0) {\n                        this.cache.put(this.resource, xhr.response, () => { /**/ });\n                    }\n\n                    return this.options.success(xhr.response);\n                }\n            } else if (this.options.fail) {\n                this.options.fail(this.resource, xhr.status, \"connection problem\");\n                return delete this.options.fail;\n            }\n        }\n    }\n\n}\n","\n// # Example\n// ```javascript\n// Dos(canvas).ready((fs, main) => {\n//     fs.extract(\"digger.zip\").then(() => {\n//         main([\"-c\", \"DIGGER.COM\"])\n//     });\n// });\n// ```\n// Dos function is entry point that provides emulation layer.\n// As emulation layer js-dos uses [DosBox ported to emscripten](https://github.com/dreamlayers/em-dosbox/#compiling).\n\n// # Dos\n\nimport openCache from \"./js-dos-cache\";\nimport { DosCommandInterface } from \"./js-dos-ci\";\nimport { DosFS } from \"./js-dos-fs\";\nimport { Host } from \"./js-dos-host\";\nimport { DosModule } from \"./js-dos-module\";\nimport { DosOptions } from \"./js-dos-options\";\n\n// When you call `Dos(canvas, options)` js-dos behind the scene will download\n// dosbox and prepare it to start. This function will return `Promise<DosReadyPromise>`\n// that will be resolved when dosbox is ready. In case of error promise\n// will be rejected.\n//\n// * `canvas`: HTMLCanvasElement - this canvas element is used as window for dosbox\n// * `options`: [DosOptions](https://js-dos.com/6.22/docs/api/generate.html?page=js-dos-options) -\n// optional configuration object\nexport type DosFactory = (canvas: HTMLCanvasElement, options?: DosOptions) => DosReadyPromise;\nconst Dos: DosFactory = (canvas: HTMLCanvasElement, options?: DosOptions) => {\n    const promise = new Promise<DosRuntime>((resolve, reject) => {\n        const module = new DosModule(canvas, resolve);\n\n        if (!options) {\n            options = {};\n        }\n\n        if (!options.onerror) {\n            options.onerror = (message: string) => {\n                /* tslint:disable:no-console */\n                console.error(message);\n                /* tslint:enable:no-console */\n            };\n        }\n\n        Object.assign(module, options);\n\n        // ### Error handling\n        // Error handling should support both ways:\n        //\n        // * Through rejecting of promise\n        // * Fire onerror function of DosOptions object\n\n        const onerror = module.onerror;\n        module.onerror = (message: string) => {\n            reject(message);\n\n            const fn = () => {\n                if (onerror) {\n                    onerror(message);\n                    module.onerror = onerror;\n                } else {\n                    module.onerror = module.error;\n                }\n            };\n\n            setTimeout(fn, 1);\n        };\n\n        module.resolve();\n        if (!module.isValid) {\n            return;\n        }\n\n        openCache(module, (cache) => {\n            // See [Host](https://js-dos.com/6.22/docs/api/generate.html?page=js-dos-host)\n            // to understand resolving of emulation layer (dosbox).\n            Host.resolveDosBox(module.wdosboxUrl as string, cache, module);\n        });\n\n    });\n\n// ### DosReadyPromise\n// Is a Promise object with additional method ready.\n// Method `ready` is just a wrapper over `then` method that\n// split resolved object into meaningful parts.\n\n    const dosReadyPromise = (promise as unknown) as DosReadyPromise;\n    dosReadyPromise.ready = (onready) => {\n        dosReadyPromise.then((runtime: DosRuntime) => {\n            onready(runtime.fs, runtime.main);\n        });\n        return dosReadyPromise;\n    };\n    return dosReadyPromise;\n};\n\nexport default Dos;\n\nexport type DosMainFn = (args?: string[]) => Promise<DosCommandInterface>;\n\n// Plain promise will be resolved with `DosRuntime` interface, that\n// includes:\n//\n// * `fs`: [DosFS](https://js-dos.com/6.22/docs/api/generate.html?page=js-dos-fs) -\n// API for working with dosbox filesystem\n// * `main`: DosMainFn - a function that you should call to actuall start\n// dosbox. It's like a main function in C++, or shell command line. This function\n// will return Promise of [DosCommandInterface](https://js-dos.com/6.22/docs/api/generate.html?page=js-dos-ci).\n// You can use it to control runned dosbox.\nexport interface DosRuntime {\n    fs: DosFS;\n    main: DosMainFn;\n}\n\nexport interface DosReadyPromise extends Promise<DosRuntime> {\n    // `onready` - callback that receive DosRuntime splitted by fields\n    ready: (onready: (fs: DosFS, main: DosMainFn) => void) => Promise<DosRuntime>;\n}\n\n(window as any).Dos = Dos;\n"]}